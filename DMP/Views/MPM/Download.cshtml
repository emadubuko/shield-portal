@model List<CommonUtil.Entities.State>

@{
    Layout = "~/Views/Shared/_mpmlayout.cshtml";
} 
<div class="col-sm-2" style="margin: 50px;">
    <div class="form-group">
        <label style="font-size: 18px;font-weight: normal;">Select a State</label>
        <select class="form-control" id="selected_state">
            <option class="form-control" value='' disabled selected></option>
            @foreach (CommonUtil.Entities.State st in Model as List<CommonUtil.Entities.State>)
            {
                <option class="form-control" value='@st.state_name'>@st.state_name</option>
            }
        </select>
        <input type="button" id="download" value="Download" class="btn btn-primary" style="margin:20px 0px;">
        <img id="loadImg" style="display:none" class="center" src="~/images/ms-spinner.gif" width="36">
    </div>

    <div class="form-group">
        <div class="col-sm-3 col-sm-push-2">
            <hr />
            <label id="error" style="display:none;"></label>
        </div>
    </div>
</div>


@section Scripts
{

    <script>
        $(document).ready(function () {

            $(".tabToolbarButton.tab-widget.edit").hide();

            $("#download").click(function (e, n) {
                $("#error").empty();
                $('#upload').prop("disabled", true);
                $("#loadImg").show();

                let selected_state =  $("#selected_state").val();
                 
                $.ajax({
                    type: "POST",
                    url: '/MPM/DownloadTemplate?state=' + selected_state,
                    contentType: "application/json; charset=utf-8",
                    cache: false,
                }).done(function (file) {
                    window.location = '/Report/Template/MPM/' + file;
                    $('#upload').prop("disabled", false);
                    $("#loadImg").hide();
                }).error(function (xhr, status, err) {
                    $('#upload').prop("disabled", false);
                    $("#loadImg").hide();
                    $("#error").empty();
                    $("#error").append(err);
                    $("#error").show();
                });
                return false;
            });

        });
    </script>
}