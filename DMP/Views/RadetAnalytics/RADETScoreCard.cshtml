
@{
    Layout = "~/Views/Shared/_radetLayoutPage.cshtml";
}

<div class="col-sm-10">
    <div class="panel panel-info">
        <div class="panel-heading clearfix">
            <h4 class="panel-title" style="margin-left: 20%;">RADET Submission Score Card (<i style="color: yellow;font-size: 15px;">Q1 FY18</i>)</h4>
        </div>
        <div class="panel-body">

            @*<div class="table-responsive">
                    <hr />
                    <i style="color: mediumblue;margin-left: 30%;font-size: 17px;">Q1 FY18</i>
                    <hr />
                    <table id="scorecardQ1" class="table table-striped table-hover" style="font-size: 12px;">
                        <thead>
                            <tr style="text-transform:capitalize;">
                                <th> Partners </th>
                                <th> Report Period </th>
                                <th> Facilities Submitted</th>
                                <th> Total ART Sites </th>
                                <th>% completion</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>*@
            <div class="row">
                <div class="col-sm-12" id="summary">
                    <center>
                        <img src="~/images/Loading_icon.gif" alt="loading" />
                    </center>
                </div>
            </div>

            <label style="padding-left:35%;margin-top:5%;font-style:italic">@DateTime.Now.AddHours(1).ToString("dd MMM yyyy hh:mm:ss tt")</label>
        </div>
    </div>
</div>

@section Scripts
{
    <script src="~/plugins/knob/js/jquery.knob.min.js"></script>
    <script>
        $(document).ready(function () {

            $.ajax({
                url: "/RadetAnalytics/RADETScoreCardData",
                method: "Post",
                contentType: "application/json",
                success: function (data) {
                    var jsonHtmlTable = buildTable(JSON.parse(data))
                }
            });


            function buildTable(dataList) {
                $("#summary").empty();
                $("#scorecard tbody").empty();
                $.each(dataList, function (i, d) {
                    var totalSites = 0;
                    if (d.ShortName === "APIN") {
                        totalSites = 332;
                    } else if (d.ShortName === "CCFN") {
                        totalSites = 92;
                    } else if (d.ShortName === "CIHP") {
                        totalSites = 90;
                    } else if (d.ShortName === "IHVN") {
                        totalSites = 296;
                    }
                    var percentage = ((parseInt(d.FacilityCount) / parseInt(totalSites)) * 100).toFixed(2);
                    if (percentage > 100) {
                        percentage = 100;
                    }
                    var pending = "";
                    if ((totalSites - d.FacilityCount) > 1) {
                        pending = Math.abs(totalSites - d.FacilityCount) + " facilities are yet to be uploaded."
                    }
                    else {
                        pending = "All facilities have been uploaded";
                    }
                    //var pending = Math.abs(totalSites - d.FacilityCount);

                    var html = "<tr> ";
                    html += "<td>" + d.ShortName + "</td>";
                    html += "<td>" + d.RadetPeriod + "</td>";
                    html += "<td>" + d.FacilityCount + "</td>";
                    html += "<td>" + totalSites + "</td>";
                    if ((parseInt(d.FacilityCount) / parseInt(totalSites)) >= 1) {
                        html += "<td style='background-color:limegreen;color:#fff;text-align: center;'>" + (100 * parseInt(d.FacilityCount) / parseInt(totalSites)).toFixed(1) + " %</td>";
                    }
                    else {
                        html += "<td style='background-color:red;color:#fff;text-align: center;'>" + (100 * parseInt(d.FacilityCount) / parseInt(totalSites)).toFixed(1) + "% </td>";
                    }
                    html += "</tr>";
                    if (d.RadetPeriod == "Q4 FY18") {
                        $("#scorecardQ4 tbody").append(html);
                    }
                    else if (d.RadetPeriod == "Q3 FY18") {
                        $("#scorecardQ3 tbody").append(html);
                    }
                    else if (d.RadetPeriod == "Q2 FY18") {
                        $("#scorecardQ2 tbody").append(html);
                    }
                    else if (d.RadetPeriod == "Q1 FY18") {
                        $("#scorecardQ1 tbody").append(html);
                        var value = '<div class="col-lg-4"><div class="panel panel-default"><div class="panel-body"><div class="media"><div class="media-left"><div class="knob-outer"><input type="text" readonly class="knob" data-width="82" data-height="82" data-fgColor="#29B6F6" value="' + percentage + '"></div></div><div class="media-body"><h4 class="media-heading">' + d.FacilityCount + ' facilities uploaded</h4><p>' + pending + '</p><button class="btn btn-sm btn-success">' + d.ShortName + '</button></div></div></div></div></div>';
                        $("#summary").append(value);
                    }
                });

                $(".knob").knob();
            }





            //function buildTable(dataList) {
            //    $("#scorecard tbody").empty();
            //    $.each(dataList, function (i, d) {
            //        var totalSites = 0;
            //        if (d.ShortName === "APIN") {
            //            totalSites = 332;
            //        } else if (d.ShortName === "CCFN") {
            //            totalSites = 92;
            //        } else if (d.ShortName === "CIHP") {
            //            totalSites = 90;
            //        } else if (d.ShortName === "IHVN") {
            //            totalSites = 296;
            //        }
            //        var html = "<tr> ";
            //        html += "<td>" + d.ShortName + "</td>";
            //        html += "<td>" + d.RadetPeriod + "</td>";
            //        html += "<td>" + d.FacilityCount + "</td>";
            //        html += "<td>" + totalSites + "</td>";
            //        if ((parseInt(d.FacilityCount) / parseInt(totalSites)) >= 1) {
            //            html += "<td style='background-color:limegreen;color:#fff;text-align: center;'>" + (100 * parseInt(d.FacilityCount) / parseInt(totalSites)).toFixed(1) + " %</td>";
            //        }
            //        else {
            //            html += "<td style='background-color:red;color:#fff;text-align: center;'>" + (100 * parseInt(d.FacilityCount) / parseInt(totalSites)).toFixed(1) + "% </td>";
            //        }
            //        html += "</tr>";
            //        if (d.RadetPeriod == "Q4 FY18") {
            //            $("#scorecardQ4 tbody").append(html);
            //        }
            //        else if (d.RadetPeriod == "Q3 FY18") {
            //            $("#scorecardQ3 tbody").append(html);
            //        }
            //        else if (d.RadetPeriod == "Q2 FY18") {
            //            $("#scorecardQ2 tbody").append(html);
            //        }
            //        else if (d.RadetPeriod == "Q1 FY18") {
            //            $("#scorecardQ1 tbody").append(html);
            //        }
            //    });
            //}

        });
    </script>
}
